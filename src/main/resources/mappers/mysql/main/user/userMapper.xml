<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.main.system.user.mapper.UserMapper">

    <select id="selectUser" parameterType="Map" resultType="User">
		/** com.example.main.system.user.mapper.UserMapper.selectUser **/
        SELECT * FROM ${main.db.schema}.user_mst WHERE user_id = #{userId} AND delete_yn = 'N'
    </select>
    
    <update id="updateLastLoginDt" parameterType="Map">
		/** com.example.main.system.user.mapper.UserMapper.updateLastLoginDt **/
		UPDATE ${main.db.schema}.user_mst
		SET
			last_login_dt = NOW() 
			, login_stat = 'Y'
		WHERE user_id = #{userId}
	</update>
	
	<select id="selectUserByAll" parameterType="Map" resultType="User">
		/** com.example.main.system.user.mapper.UserMapper.selectUserByAll **/
        SELECT * FROM ${main.db.schema}.user_mst WHERE user_id = #{userId}
    </select>
    
    <select id="cntUserByAll" parameterType="Map" resultType="int">
		/** com.example.main.system.user.mapper.UserMapper.selectUserByAll */
        SELECT COUNT(*) FROM ${main.db.schema}.user_mst WHERE user_id = #{userId} AND delete_yn = 'Y'
    </select>
    
    <insert id="insertUser" parameterType="Map">
		/** com.example.main.system.user.mapper.UserMapper.insertUser **/
		INSERT INTO ${main.db.schema}.user_mst (
			user_id
			, user_pwd
			, user_nm
			, department
			, email
			, phone
			, remark
			, use_yn
			, reg_id
			, reg_dt
		)
		VALUES 
		<foreach collection="list" item="item" separator=",">
			(#{item.userId}, #{item.userPwd}, #{item.userNm}, #{item.department}, #{item.email}, #{item.phone}, #{item.remark}, #{item.useYn}, #{baseUserId}, NOW())
		</foreach>
		ON DUPLICATE KEY UPDATE
			user_nm = VALUES(user_nm)
			, department = VALUES(department)
			, email = VALUES(email)
			, phone = VALUES(phone)
			, remark = VALUES(remark)
			, use_yn = VALUES(use_yn)
			, chg_id = #{baseUserId}
			, chg_dt = NOW()
    </insert>

</mapper>
